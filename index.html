<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JR DENT</title>

  <style>
   @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap');

body {
  font-family: 'Montserrat', sans-serif;
  font-weight: 400; /* normal */
  background: #f6f7fb;
  color: #111;

    /* ====== TOP BAR ====== */
    .topbar {
      background: #F5F7FA;
      color: white;
      padding: 10px 0;
    }

    .container {
      width: min(1100px, 92%);
      margin: 0 auto;
    }

    .topbar-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .brand { display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px; }
    .logo-img { height: 80px; width: auto; display:block; }

    .search {
      flex: 1;
      display: flex;
      gap: 8px;
      max-width: 520px;
      margin: 0 12px;
    }

    .search input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      outline: none;
    }

    .search button {
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      background: #1B0561;
      color: white;
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .linkbtn {
      background: transparent;
      border: 2px solid #1B0561;
      color: #1B0561;
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      transition: 0.3s;
    }
    .linkbtn:hover { background: white; color: #111; }

    .cart-btn{
      position: relative;
      background: transparent;
      border: 2px solid #1B0561;
      color: #1B0561;
      font-size: 20px;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    .cart-btn:hover{ background:white; color:#111; }

    .cart-count{
      position:absolute;
      top:-6px;
      right:-6px;
      background:red;
      color:white;
      font-size:12px;
      padding:2px 6px;
      border-radius:50%;
    }

    /* PERFIL */
    .userpill{
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius: 999px;
      border: 2px solid white;
      background: rgba(255,255,255,0.12);
      color: white;
      cursor:pointer;
      font-weight:900;
      transition: .25s;
    }
    .userpill:hover{
      background: white;
      color:#111;
    }
    .avatar{
      width:34px;
      height:34px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      background: rgba(0,0,0,0.18);
      font-weight: 900;
    }
    .userpill:hover .avatar{
      background: rgba(0,0,0,0.12);
    }
    .username{
      max-width: 140px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* =========================================================
       ‚úÖ SUBBAR NUEVA estilo RITO (blanca + separadores + ‚ÄúAll products‚Äù)
       ========================================================= */
    .subbar {
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
    }

    .subbar-inner{
      width: min(1100px, 92%);
      margin: 0 auto;
      display:flex;
      align-items:center;
      gap: 18px;
      padding: 12px 0;
    }

    /* Bloque izquierdo: Todos nuestros productos */
    .all-products{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 16px;
      border-radius: 10px;
      background: #1B0561; /* color original subbar */
      color: #fff;
      font-weight: 900;
      cursor: pointer;
      user-select:none;
      transition: .2s;
      white-space: nowrap;
    }
    .all-products:hover{ filter: brightness(1.08); }
    .hamburger{
      width: 18px;
      height: 12px;
      position: relative;
      display:inline-block;
    }
    .hamburger span{
      position:absolute;
      left:0; right:0;
      height: 2px;
      background:#fff;
      border-radius: 2px;
    }
    .hamburger span:nth-child(1){ top:0; }
    .hamburger span:nth-child(2){ top:5px; opacity:.9; }
    .hamburger span:nth-child(3){ top:10px; opacity:.85; }

    /* Men√∫ */
    .subbar ul{
      list-style:none;
      display:flex;
      align-items:center;
      flex-wrap: wrap;
      gap: 0; /* no gap, porque separaremos con bordes */
      margin-left: 6px;
    }

    .subbar li{
      display:flex;
      align-items:center;
    }

    /* Links sin fondo */
    .subbar a{
      color:#1B0561;
      text-decoration:none;
      font-weight: 800;
      font-size: 15px;
      padding: 10px 16px;
      line-height: 1;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition: .18s;
    }

    /* Separadores verticales */
    .subbar li + li{
      border-left: 1px solid #e5e7eb;
    }

    .subbar a:hover{
      color:#2563eb;
      background: rgba(37,99,235,0.06);
    }

    /* ===== SLIDER ===== */
    .slider {
      position: relative;
      width: min(1200px, 92%);
      margin: 20px auto;
      overflow: hidden;
      border-radius: 16px;
      background: #e5e7eb;
    }
    .slides { position: relative; height: 480px; }
    .slide {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      background: #e5e7eb;
      opacity: 0;
      transition: opacity 0.6s ease;
    }
    .slide.active { opacity: 1; }

    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      border: none;
      color: white;
      font-size: 24px;
      padding: 10px 14px;
      cursor: pointer;
      border-radius: 50%;
      z-index: 10;
    }
    .arrow.left { left: 15px; }
    .arrow.right { right: 15px; }
    .arrow:hover { background: rgba(0,0,0,0.8); }

    /* ====== MAIN ====== */
    main { padding: 28px 0; }
    .card {
      background: white;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
    }

    /* ====== AUTH SECTION ====== */
    .auth-wrap {
      width: min(520px, 92%);
      margin: 22px auto 10px;
    }
    .auth-card {
      background: white;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.10);
      position: relative;
      overflow: hidden;
    }
    .auth-title { font-size: 28px; margin-bottom: 6px; }
    .auth-sub { color:#666; margin-bottom: 14px; }

    .auth-tabs {
      display:flex;
      gap:10px;
      margin-bottom: 14px;
    }
    .auth-tab {
      flex:1;
      padding:10px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background:#f9fafb;
      cursor:pointer;
      font-weight: 800;
    }
    .auth-tab.active { background:#2563eb; color:white; border-color:#2563eb; }

    .grid2 { display:grid; gap:10px; grid-template-columns: 1fr 1fr; }
    .grid1 { display:grid; gap:10px; grid-template-columns: 1fr; }

    label { font-size: 13px; font-weight: 800; color:#111; }
    input {
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      outline: none;
    }
    input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37,99,235,0.12);
    }

    .btn-row { display:grid; gap:10px; margin-top: 12px; }

    .btn-primary {
      padding: 10px 12px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-weight: 900;
      background: #22c55e;
      color: #0b1020;
    }

    .btn-google {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      cursor: pointer;
      font-weight: 900;
      background: white;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .gicon { width:18px; height:18px; display:block; }

    .auth-hint { font-size: 12px; color:#666; margin-top: 10px; }
    .auth-error { color:#b91c1c; font-weight:800; margin-top:10px; display:none; }
    .auth-ok { color:#166534; font-weight:800; margin-top:10px; display:none; }

    .hidden { display:none !important; }

    /* OVERLAY success dentro del cuadro */
    .success-overlay{
      position:absolute;
      inset:0;
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(6px);
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index: 50;
    }
    .success-overlay.show{ display:flex; }
    .success-box{
      background:white;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.12);
      text-align:center;
      width: min(360px, 92%);
    }
    .success-check{
      width:52px; height:52px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      background:#22c55e;
      color:white;
      font-size: 30px;
      margin: 0 auto 10px;
      font-weight: 900;
    }
    .success-title{ font-size: 18px; font-weight: 900; margin-bottom: 6px; }
    .success-text{ color:#444; font-size: 14px; }

    /* ====== RESPONSIVE ====== */
    @media (max-width: 760px) {
      .search { display: none; }
      .slides { height: 260px; }
      .logo-img { height: 60px; }
      .grid2 { grid-template-columns: 1fr; }

      .subbar-inner{
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      .subbar ul{
        justify-content: center;
      }
      .subbar a{
        padding: 9px 12px;
        font-size: 14px;
      }
      .all-products{
        justify-content:center;
      }
    }
  </style>
</head>

<body>
  <!-- TOP BAR -->
  <header class="topbar">
    <div class="container topbar-row">
      <div class="brand">
        <img src="logojr.png" alt="JR DENT" class="logo-img">
      </div>

      <div class="search">
        <input type="text" placeholder="Buscar productos, repuestos, servicios..." />
        <button type="button">Buscar</button>
      </div>

      <div class="actions">
        <button class="linkbtn" id="btnLogin" type="button">Iniciar sesi√≥n</button>
        <button class="linkbtn" id="btnRegister" type="button">Crear cuenta</button>

        <!-- PERFIL (solo logueado) -->
        <button class="userpill hidden" id="userPill" type="button" title="Mi cuenta">
          <span class="avatar" id="avatarInitials">JR</span>
          <span class="username" id="userName">Usuario</span>
        </button>

        <button class="linkbtn" id="btnOrders" type="button">Mis compras</button>
        <button class="linkbtn hidden" id="btnLogout" type="button">Salir</button>

        <button class="cart-btn" type="button" id="btnCart">
          üõí <span class="cart-count" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- SUB BAR NUEVA -->
  <nav class="subbar">
    <div class="subbar-inner">
      <div class="all-products" id="allProductsBtn" title="Ver todos los productos">
        <span class="hamburger" aria-hidden="true">
          <span></span><span></span><span></span>
        </span>
        Todos nuestros productos
      </div>

      <ul>
        <li><a href="#" id="navHome">Inicio</a></li>
        <li><a href="#">Repuestos</a></li>
        <li><a href="#">Piezas de mano</a></li>
        <li><a href="#">Servicio t√©cnico</a></li>
        <li><a href="#">Contacto</a></li>
      </ul>
    </div>
  </nav>

  <!-- HOME -->
  <section id="homeSection">
    <section class="slider" id="homeSlider">
      <div class="slides">
        <img src="imagen1.jpg" class="slide active" alt="Banner 1">
        <img src="imagen2.jpg" class="slide" alt="Banner 2">
        <img src="imagen3.jpg" class="slide" alt="Banner 3">
      </div>
      <button class="arrow left" id="prevBtn" type="button">‚ùÆ</button>
      <button class="arrow right" id="nextBtn" type="button">‚ùØ</button>
    </section>

    <main>
      <div class="container">
        <div class="card">
          <h1>Bienvenido a JR DENT</h1>
          <p>Tu p√°gina ya tiene la banda superior. Ahora iremos armando el resto (banner, productos, etc.).</p>
        </div>
      </div>
    </main>
  </section>

  <!-- AUTH -->
  <section id="authSection" class="hidden">
    <div class="auth-wrap">
      <div class="auth-card" id="authCard">
        <!-- Overlay success -->
        <div class="success-overlay" id="successOverlay">
          <div class="success-box">
            <div class="success-check">‚úì</div>
            <div class="success-title" id="successTitle">¬°Listo!</div>
            <div class="success-text" id="successText">Ya te has registrado.</div>
          </div>
        </div>

        <h2 class="auth-title" id="authTitle">Iniciar sesi√≥n</h2>
        <p class="auth-sub" id="authSub">Accede para ver tus compras y guardar favoritos.</p>

        <div class="auth-tabs">
          <button class="auth-tab active" id="tabLogin" type="button">Login</button>
          <button class="auth-tab" id="tabRegister" type="button">Registro</button>
        </div>

        <!-- LOGIN FORM -->
        <div id="loginForm">
          <div class="grid1">
            <div>
              <label for="loginEmail">Correo</label>
              <input id="loginEmail" type="email" placeholder="correo@email.com" />
            </div>
            <div>
              <label for="loginPassword">Contrase√±a</label>
              <input id="loginPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            </div>
          </div>

          <div class="btn-row">
            <button class="btn-primary" id="btnDoLogin" type="button">Entrar</button>

            <button class="btn-google" id="btnGoogleLogin" type="button">
              <!-- Google G (SVG) -->
              <svg class="gicon" viewBox="0 0 48 48" aria-hidden="true">
                <path fill="#EA4335" d="M24 9.5c3.54 0 6.02 1.53 7.41 2.81l5.41-5.41C33.6 4.02 29.2 2 24 2 14.62 2 6.51 7.38 2.69 15.19l6.78 5.26C11.27 14.57 17.12 9.5 24 9.5z"/>
                <path fill="#4285F4" d="M46.5 24.5c0-1.64-.15-2.83-.47-4.07H24v7.72h12.84c-.26 2.07-1.68 5.19-4.84 7.28l7.43 5.76c4.32-4 7.07-9.88 7.07-16.69z"/>
                <path fill="#FBBC05" d="M9.47 28.45c-.42-1.26-.66-2.6-.66-3.95s.24-2.69.65-3.95l-6.78-5.26C1.06 18.62 0 21.48 0 24.5c0 3.02 1.06 5.88 2.68 8.21l6.79-4.26z"/>
                <path fill="#34A853" d="M24 47c6.2 0 11.4-2.05 15.2-5.58l-7.43-5.76c-2 1.39-4.7 2.37-7.77 2.37-6.88 0-12.73-5.07-14.53-11.95l-6.79 4.26C6.51 40.62 14.62 47 24 47z"/>
              </svg>
              Continuar con Google
            </button>
          </div>
        </div>

        <!-- REGISTER FORM -->
        <div id="registerForm" class="hidden">
          <div class="grid2">
            <div>
              <label for="regName">Nombre</label>
              <input id="regName" type="text" placeholder="Tu nombre completo" />
            </div>
            <div>
              <label for="regPhone">Tel√©fono</label>
              <input id="regPhone" type="tel" placeholder="Ej: 999 999 999" />
            </div>
          </div>

          <div class="grid2" style="margin-top:10px;">
            <div>
              <label for="regCountry">Pa√≠s</label>
              <input id="regCountry" type="text" placeholder="Ej: Per√∫" />
            </div>
            <div>
              <label for="regDistrict">Distrito</label>
              <input id="regDistrict" type="text" placeholder="Ej: Los Olivos" />
            </div>
          </div>

          <div class="grid1" style="margin-top:10px;">
            <div>
              <label for="regAddress">Direcci√≥n</label>
              <input id="regAddress" type="text" placeholder="Ej: Av. ... #..." />
            </div>
          </div>

          <div class="grid1" style="margin-top:10px;">
            <div>
              <label for="regEmail">Correo</label>
              <input id="regEmail" type="email" placeholder="correo@email.com" />
            </div>
          </div>

          <div class="grid2" style="margin-top:10px;">
            <div>
              <label for="regPassword">Contrase√±a</label>
              <input id="regPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            </div>
            <div>
              <label for="regPassword2">Confirmar contrase√±a</label>
              <input id="regPassword2" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            </div>
          </div>

          <div class="btn-row">
            <button class="btn-primary" id="btnDoRegister" type="button">Crear cuenta</button>

            <button class="btn-google" id="btnGoogleRegister" type="button">
              <svg class="gicon" viewBox="0 0 48 48" aria-hidden="true">
                <path fill="#EA4335" d="M24 9.5c3.54 0 6.02 1.53 7.41 2.81l5.41-5.41C33.6 4.02 29.2 2 24 2 14.62 2 6.51 7.38 2.69 15.19l6.78 5.26C11.27 14.57 17.12 9.5 24 9.5z"/>
                <path fill="#4285F4" d="M46.5 24.5c0-1.64-.15-2.83-.47-4.07H24v7.72h12.84c-.26 2.07-1.68 5.19-4.84 7.28l7.43 5.76c4.32-4 7.07-9.88 7.07-16.69z"/>
                <path fill="#FBBC05" d="M9.47 28.45c-.42-1.26-.66-2.6-.66-3.95s.24-2.69.65-3.95l-6.78-5.26C1.06 18.62 0 21.48 0 24.5c0 3.02 1.06 5.88 2.68 8.21l6.79-4.26z"/>
                <path fill="#34A853" d="M24 47c6.2 0 11.4-2.05 15.2-5.58l-7.43-5.76c-2 1.39-4.7 2.37-7.77 2.37-6.88 0-12.73-5.07-14.53-11.95l-6.79 4.26C6.51 40.62 14.62 47 24 47z"/>
              </svg>
              Registrarme con Google
            </button>
          </div>
        </div>

        <div class="auth-error" id="authError"></div>
        <div class="auth-ok" id="authOk"></div>

        <div class="auth-hint">
          * El registro guarda tus datos en Firebase (Auth + Firestore).
        </div>
      </div>
    </div>
  </section>

  <!-- ====== JS UI + SLIDER ====== -->
  <script>
    const homeSection = document.getElementById("homeSection");
    const authSection = document.getElementById("authSection");

    const btnLogin = document.getElementById("btnLogin");
    const btnRegister = document.getElementById("btnRegister");
    const btnOrders = document.getElementById("btnOrders");
    const btnLogout = document.getElementById("btnLogout");
    const userPill = document.getElementById("userPill");
    const avatarInitials = document.getElementById("avatarInitials");
    const userName = document.getElementById("userName");

    const navHome = document.getElementById("navHome");

    const tabLogin = document.getElementById("tabLogin");
    const tabRegister = document.getElementById("tabRegister");

    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");

    const authTitle = document.getElementById("authTitle");
    const authSub = document.getElementById("authSub");

    const authError = document.getElementById("authError");
    const authOk = document.getElementById("authOk");

    const successOverlay = document.getElementById("successOverlay");
    const successTitle = document.getElementById("successTitle");
    const successText = document.getElementById("successText");

    function showError(msg) {
      authOk.style.display = "none";
      authError.style.display = "block";
      authError.textContent = msg;
    }
    function showOk(msg) {
      authError.style.display = "none";
      authOk.style.display = "block";
      authOk.textContent = msg;
    }
    function clearMsgs() {
      authError.style.display = "none";
      authOk.style.display = "none";
      authError.textContent = "";
      authOk.textContent = "";
    }

    function showSuccessOverlay(title, text, autoHideMs = 1200) {
      successTitle.textContent = title || "¬°Listo!";
      successText.textContent = text || "Operaci√≥n exitosa.";
      successOverlay.classList.add("show");
      if (autoHideMs) {
        setTimeout(() => successOverlay.classList.remove("show"), autoHideMs);
      }
    }
    window.showSuccessOverlay = showSuccessOverlay;

    function showHome() {
      clearMsgs();
      authSection.classList.add("hidden");
      homeSection.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function showAuth(mode) {
      clearMsgs();
      homeSection.classList.add("hidden");
      authSection.classList.remove("hidden");
      setAuthMode(mode);
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function setAuthMode(mode) {
      const isLogin = mode === "login";
      tabLogin.classList.toggle("active", isLogin);
      tabRegister.classList.toggle("active", !isLogin);
      loginForm.classList.toggle("hidden", !isLogin);
      registerForm.classList.toggle("hidden", isLogin);

      authTitle.textContent = isLogin ? "Iniciar sesi√≥n" : "Crear cuenta";
      authSub.textContent = isLogin
        ? "Accede para ver tus compras y guardar favoritos."
        : "Reg√≠strate para comprar m√°s r√°pido y ver tu historial.";
    }

    btnLogin.addEventListener("click", () => showAuth("login"));
    btnRegister.addEventListener("click", () => showAuth("register"));
    navHome.addEventListener("click", (e) => { e.preventDefault(); showHome(); });

    tabLogin.addEventListener("click", () => setAuthMode("login"));
    tabRegister.addEventListener("click", () => setAuthMode("register"));

    // ‚úÖ All products (por ahora demo)
    document.getElementById("allProductsBtn").addEventListener("click", () => {
      alert("Aqu√≠ luego ir√°: cat√°logo / todos los productos");
    });

    // PERFIL click (por ahora demo)
    userPill.addEventListener("click", () => {
      alert("Aqu√≠ luego ir√°: Mi cuenta / Perfil");
    });

    // Slider
    document.addEventListener("DOMContentLoaded", () => {
      const slider = document.getElementById("homeSlider");
      const slides = slider ? slider.querySelectorAll(".slide") : [];
      const nextBtn = document.getElementById("nextBtn");
      const prevBtn = document.getElementById("prevBtn");

      if (!slider || slides.length === 0 || !nextBtn || !prevBtn) return;

      let current = 0;
      function show(i) {
        slides.forEach(s => s.classList.remove("active"));
        slides[i].classList.add("active");
      }
      function next() { current = (current + 1) % slides.length; show(current); }
      function prev() { current = (current - 1 + slides.length) % slides.length; show(current); }

      nextBtn.addEventListener("click", next);
      prevBtn.addEventListener("click", prev);
      setInterval(next, 5000);
    });

    // ===== Topbar: mostrar/ocultar seg√∫n sesi√≥n =====
    function setTopbarUser(userData) {
      if (!userData) {
        btnLogin.classList.remove("hidden");
        btnRegister.classList.remove("hidden");
        userPill.classList.add("hidden");
        btnLogout.classList.add("hidden");
        avatarInitials.textContent = "JR";
        userName.textContent = "Usuario";
        return;
      }

      btnLogin.classList.add("hidden");
      btnRegister.classList.add("hidden");
      userPill.classList.remove("hidden");
      btnLogout.classList.remove("hidden");

      const name = (userData.nombre || userData.displayName || userData.email || "Usuario").trim();

      const parts = name.split(/\s+/).filter(Boolean);
      let initials = parts[0]?.[0] || "U";
      if (parts.length >= 2) initials += parts[1][0];
      initials = initials.toUpperCase();

      avatarInitials.textContent = initials;
      userName.textContent = name;
    }
    window.setTopbarUser = setTopbarUser;
  </script>

  <!-- ====== FIREBASE (todo en 1 solo m√≥dulo, sin duplicados) ====== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup,
      createUserWithEmailAndPassword, signInWithEmailAndPassword,
      onAuthStateChanged, signOut, updateProfile
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
    import {
      getFirestore, doc, setDoc, getDoc
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    // ‚úÖ Tu config real
    const firebaseConfig = {
      apiKey: "AIzaSyDFSDPcgPmtDiNWVHZg46RKxE8ygPV99FM",
      authDomain: "jr-dent.firebaseapp.com",
      projectId: "jr-dent",
      storageBucket: "jr-dent.firebasestorage.app",
      messagingSenderId: "981855232370",
      appId: "1:981855232370:web:9c915085a08563503f7deb",
      measurementId: "G-6E1LVQLC2T"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // UI elements
    const authError = document.getElementById("authError");
    const authOk = document.getElementById("authOk");

    const loginEmail = document.getElementById("loginEmail");
    const loginPassword = document.getElementById("loginPassword");
    const btnDoLogin = document.getElementById("btnDoLogin");
    const btnGoogleLogin = document.getElementById("btnGoogleLogin");

    const regName = document.getElementById("regName");
    const regPhone = document.getElementById("regPhone");
    const regCountry = document.getElementById("regCountry");
    const regDistrict = document.getElementById("regDistrict");
    const regAddress = document.getElementById("regAddress");
    const regEmail = document.getElementById("regEmail");
    const regPassword = document.getElementById("regPassword");
    const regPassword2 = document.getElementById("regPassword2");
    const btnDoRegister = document.getElementById("btnDoRegister");
    const btnGoogleRegister = document.getElementById("btnGoogleRegister");

    const btnLogout = document.getElementById("btnLogout");

    function showError(msg) {
      authOk.style.display = "none";
      authError.style.display = "block";
      authError.textContent = msg;
    }
    function showOk(msg) {
      authError.style.display = "none";
      authOk.style.display = "block";
      authOk.textContent = msg;
    }

    async function saveUserProfile(uid, data) {
      await setDoc(doc(db, "users", uid), {
        ...data,
        updatedAt: new Date().toISOString()
      }, { merge: true });
    }

    async function loadProfile(uid) {
      const snap = await getDoc(doc(db, "users", uid));
      return snap.exists() ? snap.data() : null;
    }

    // ====== Estado de sesi√≥n ======
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.setTopbarUser?.(null);
        return;
      }

      // Intentar traer nombre desde Firestore
      let profile = null;
      try { profile = await loadProfile(user.uid); } catch(e) {}

      window.setTopbarUser?.({
        nombre: profile?.nombre || user.displayName || "",
        email: user.email || "",
        displayName: user.displayName || ""
      });
    });

    // ====== LOGIN EMAIL ======
    btnDoLogin.addEventListener("click", async () => {
      try {
        const email = (loginEmail.value || "").trim();
        const pass = loginPassword.value || "";
        if (!email || !pass) return showError("Completa correo y contrase√±a.");

        await signInWithEmailAndPassword(auth, email, pass);
        showOk("‚úÖ Sesi√≥n iniciada.");
        window.showSuccessOverlay?.("¬°Bienvenido!", "Sesi√≥n iniciada correctamente.", 900);

        // volver al inicio
        setTimeout(() => document.getElementById("navHome").click(), 900);
      } catch (e) {
        showError(e.message);
      }
    });

    // ====== LOGIN GOOGLE ======
    btnGoogleLogin.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);

        await saveUserProfile(result.user.uid, {
          email: result.user.email || "",
          nombre: result.user.displayName || ""
        });

        window.setTopbarUser?.({
          nombre: result.user.displayName || "",
          email: result.user.email || ""
        });

        showOk("‚úÖ Entraste con Google.");
        window.showSuccessOverlay?.("¬°Bienvenido!", "Entraste con Google.", 900);
        setTimeout(() => document.getElementById("navHome").click(), 900);
      } catch (e) {
        showError(e.message);
      }
    });

    // ====== REGISTER EMAIL ======
    btnDoRegister.addEventListener("click", async () => {
      try {
        const nombre = (regName.value || "").trim();
        const telefono = (regPhone.value || "").trim();
        const pais = (regCountry.value || "").trim();
        const distrito = (regDistrict.value || "").trim();
        const direccion = (regAddress.value || "").trim();

        const email = (regEmail.value || "").trim();
        const pass = regPassword.value || "";
        const pass2 = regPassword2.value || "";

        if (!nombre || !pais || !distrito || !direccion || !telefono) {
          return showError("Completa: Nombre, Pa√≠s, Distrito, Direcci√≥n y Tel√©fono.");
        }
        if (!email || !pass || !pass2) return showError("Completa correo y contrase√±as.");
        if (pass.length < 6) return showError("La contrase√±a debe tener m√≠nimo 6 caracteres.");
        if (pass !== pass2) return showError("Las contrase√±as no coinciden.");

        const cred = await createUserWithEmailAndPassword(auth, email, pass);

        // poner displayName en Auth
        try { await updateProfile(cred.user, { displayName: nombre }); } catch(e){}

        await saveUserProfile(cred.user.uid, {
          nombre, pais, distrito, direccion, telefono,
          email
        });

        window.setTopbarUser?.({ nombre, email });

        showOk("‚úÖ Cuenta creada y datos guardados.");
        window.showSuccessOverlay?.("‚úÖ Registro completo", "Ya te has registrado.", 1100);

        // volver al inicio
        setTimeout(() => document.getElementById("navHome").click(), 1100);
      } catch (e) {
        showError(e.message);
      }
    });

    // ====== REGISTER GOOGLE ======
    btnGoogleRegister.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);

        await saveUserProfile(result.user.uid, {
          email: result.user.email || "",
          nombre: result.user.displayName || ""
        });

        window.setTopbarUser?.({
          nombre: result.user.displayName || "",
          email: result.user.email || ""
        });

        showOk("‚úÖ Registrado con Google.");
        window.showSuccessOverlay?.("‚úÖ Registro con Google", "Ya est√°s dentro.", 1000);
        setTimeout(() => document.getElementById("navHome").click(), 1000);
      } catch (e) {
        showError(e.message);
      }
    });

    // ====== LOGOUT ======
    btnLogout.addEventListener("click", async () => {
      try {
        await signOut(auth);
        window.setTopbarUser?.(null);
        showOk("Sesi√≥n cerrada.");
        window.showSuccessOverlay?.("Hasta luego", "Sesi√≥n cerrada.", 900);
        setTimeout(() => document.getElementById("navHome").click(), 900);
      } catch (e) {
        showError(e.message);
      }
    });
  </script>
</body>
</html>




































